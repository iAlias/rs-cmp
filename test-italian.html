<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Italiano - OpenConsent v2</title>
    
    <!-- OpenConsent v2 CMP -->
    <script src="dist/cmp.min.js" data-site-id="demo-italian-test"></script>
    <script>
        // Initialize with Italian language
        window.RSCMP.init({
            siteId: 'demo-italian-test',
            language: 'it', // Force Italian
            config: {
                banner: {
                    position: 'bottom',
                    layout: 'bar',
                    primaryColor: '#2563eb',
                    backgroundColor: '#ffffff',
                    textColor: '#1f2937',
                    buttonTextColor: '#ffffff'
                },
                categories: [
                    {
                        id: 'necessary',
                        name: 'Necessari',
                        description: 'Cookie essenziali',
                        required: true,
                        enabled: true
                    },
                    {
                        id: 'analytics',
                        name: 'Analitici',
                        description: 'Statistiche',
                        required: false,
                        enabled: false
                    },
                    {
                        id: 'marketing',
                        name: 'Marketing',
                        description: 'PubblicitÃ ',
                        required: false,
                        enabled: false
                    },
                    {
                        id: 'preferences',
                        name: 'Preferenze',
                        description: 'Impostazioni',
                        required: false,
                        enabled: false
                    }
                ]
            }
        }).then(() => {
            console.log('CMP inizializzato con successo');
        });
    </script>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        h1 {
            color: #2563eb;
        }
        .info-box {
            background: #f3f4f6;
            border-left: 4px solid #2563eb;
            padding: 20px;
            margin: 20px 0;
        }
        button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background: #1d4ed8;
        }
    </style>
</head>
<body>
    <h1>ðŸ‡®ðŸ‡¹ Test Banner Italiano</h1>
    
    <div class="info-box">
        <h2>Test del nuovo testo italiano</h2>
        <p>Questa pagina testa il nuovo testo del banner in italiano:</p>
        <p><strong>Testo atteso:</strong></p>
        <p><em>"Utilizziamo i cookie per finalitÃ  tecniche e, con il tuo consenso, anche per le finalitÃ  di esperienza, analisi e marketing come specificato nella cookie policy. Puoi liberamente prestare, rifiutare o revocare il tuo consenso, in qualsiasi momento, accedendo al pannello delle preferenze. Il rifiuto del consenso puÃ² rendere non disponibili le relative funzioni."</em></p>
    </div>
    
    <h2>Test delle funzionalitÃ </h2>
    <button onclick="window.RSCMP.showPreferences()">Mostra Banner</button>
    <button onclick="window.RSCMP.resetConsent()">Reset Consenso</button>
    <button onclick="testExpiration()">Test Scadenza (12 mesi)</button>
    <button onclick="console.log('Consenso attuale:', window.RSCMP.getConsent())">Log Consenso</button>
    
    <div class="info-box" id="test-results">
        <h3>Risultati Test Scadenza</h3>
        <p id="expiration-result">Clicca su "Test Scadenza" per testare la logica di scadenza a 12 mesi</p>
    </div>
    
    <script>
        function testExpiration() {
            // Test the 12-month expiration logic
            const resultEl = document.getElementById('expiration-result');
            
            // Save a consent that's 13 months old (395 days)
            const oldDate = new Date();
            oldDate.setTime(oldDate.getTime() - (395 * 24 * 60 * 60 * 1000));
            
            const oldConsent = {
                categories: {
                    necessary: true,
                    analytics: true,
                    marketing: false,
                    preferences: false
                },
                timestamp: oldDate.toISOString(),
                version: '1.0'
            };
            
            // Store old consent
            localStorage.setItem('rs-cmp-consent', JSON.stringify(oldConsent));
            resultEl.innerHTML = `
                <strong>âœ… Test impostato:</strong><br>
                - Consenso salvato con timestamp: ${oldDate.toISOString()}<br>
                - EtÃ : circa 13 mesi (395 giorni)<br>
                - Ricarica la pagina per vedere se viene rimosso automaticamente
            `;
            
            console.log('Old consent stored:', oldConsent);
        }
        
        // Check if consent was cleared on load
        window.addEventListener('load', () => {
            setTimeout(() => {
                const consent = window.RSCMP.getConsent();
                
                if (!consent) {
                    const storedData = localStorage.getItem('rs-cmp-consent');
                    
                    if (!storedData) {
                        console.log('âœ… Consent expiration test: Consenso scaduto rimosso correttamente');
                    }
                }
            }, 1000);
        });
    </script>
</body>
</html>
