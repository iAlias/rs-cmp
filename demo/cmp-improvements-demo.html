<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RS-CMP Improvements Demo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #333;
        }
        .demo-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: #0084ff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #0066cc;
        }
        .status-output {
            background: #f8f8f8;
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        code {
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 13px;
        }
        .feature-list {
            list-style: none;
            padding: 0;
        }
        .feature-list li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .feature-list li:before {
            content: "‚úì ";
            color: #0084ff;
            font-weight: bold;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>üç™ RS-CMP Improvements Demo</h1>
    
    <div class="demo-section">
        <h2>Features Implemented</h2>
        <ul class="feature-list">
            <li><strong>Advanced Script Detection</strong> - Auto-detects analytics and marketing scripts</li>
            <li><strong>Service Loaders</strong> - Meta Pixel, Clarity, TikTok Pixel, Google Ads</li>
            <li><strong>Inline Configuration</strong> - No API required for standalone usage</li>
            <li><strong>Debug Mode</strong> - Logging and diagnostic tools</li>
            <li><strong>Category Services UI</strong> - Detailed service information in modal</li>
            <li><strong>GTM DataLayer Integration</strong> - Push consent events to dataLayer</li>
            <li><strong>Public Methods</strong> - showPreferences(), resetConsent()</li>
        </ul>
    </div>

    <div class="demo-section">
        <h2>1. Configure Services</h2>
        <p>Configure third-party services that will load based on consent:</p>
        <button onclick="configureServices()">Configure Services</button>
        <pre class="status-output" id="service-config-output">Click button to configure services...</pre>
    </div>

    <div class="demo-section">
        <h2>2. Debug Mode</h2>
        <p>Enable debug mode to see detailed logging:</p>
        <button onclick="enableDebugMode()">Enable Debug Mode</button>
        <button onclick="disableDebugMode()">Disable Debug Mode</button>
        <button onclick="testConsentMode()">Test Consent Mode</button>
        <pre class="status-output" id="debug-output">Debug mode is currently OFF</pre>
    </div>

    <div class="demo-section">
        <h2>3. CMP Status</h2>
        <p>Get current CMP status and diagnostics:</p>
        <button onclick="getStatus()">Get Status</button>
        <pre class="status-output" id="status-output">Click button to get status...</pre>
    </div>

    <div class="demo-section">
        <h2>4. Public Methods</h2>
        <p>Control the CMP programmatically:</p>
        <button onclick="showPreferences()">Show Preferences</button>
        <button onclick="resetConsent()">Reset Consent</button>
        <pre class="status-output" id="methods-output">Use buttons to control CMP...</pre>
    </div>

    <div class="demo-section">
        <h2>5. DataLayer Events</h2>
        <p>Monitor GTM dataLayer events:</p>
        <button onclick="checkDataLayer()">Check DataLayer</button>
        <pre class="status-output" id="datalayer-output">Click button to check dataLayer...</pre>
    </div>

    <div class="demo-section">
        <h2>6. Inline Configuration Example</h2>
        <p>Initialize CMP with inline configuration (no API needed):</p>
        <pre style="background: #f8f8f8; padding: 15px; border-radius: 4px; overflow-x: auto;">
<code>// Initialize with custom config
window.RSCMP.init({
  siteName: 'My Website',
  banner: {
    position: 'bottom',
    primaryColor: '#ff6b6b'
  }
});</code></pre>
    </div>

    <!-- Load the CMP SDK -->
    <script src="../dist/cmp-js.js"></script>
    
    <script>
        // Initialize with inline config (no API needed)
        window.addEventListener('DOMContentLoaded', function() {
            // The CMP auto-initializes, but we can re-initialize with custom config
            console.log('[Demo] CMP auto-initialized');
            
            // Configure services after initialization
            setTimeout(() => {
                if (window.RSCMP) {
                    // These would be real IDs in production
                    window.RSCMP.configureService('meta-pixel', { id: 'DEMO_PIXEL_ID' });
                    window.RSCMP.configureService('clarity', { id: 'DEMO_CLARITY_ID' });
                    window.RSCMP.configureService('tiktok-pixel', { id: 'DEMO_TIKTOK_ID' });
                    console.log('[Demo] Services configured');
                }
            }, 1000);
        });

        function configureServices() {
            if (!window.RSCMP) {
                document.getElementById('service-config-output').textContent = 'Error: RSCMP not loaded';
                return;
            }
            
            window.RSCMP.configureService('meta-pixel', { id: 'YOUR_PIXEL_ID_123' });
            window.RSCMP.configureService('clarity', { id: 'YOUR_CLARITY_ID' });
            window.RSCMP.configureService('tiktok-pixel', { id: 'YOUR_TIKTOK_ID' });
            
            document.getElementById('service-config-output').textContent = 
`Services configured:
‚úì Meta Pixel: YOUR_PIXEL_ID_123
‚úì Microsoft Clarity: YOUR_CLARITY_ID
‚úì TikTok Pixel: YOUR_TIKTOK_ID

These services will load automatically when user grants consent.`;
        }

        function enableDebugMode() {
            if (!window.RSCMP) return;
            window.RSCMP.enableDebug();
            document.getElementById('debug-output').textContent = 'Debug mode is now ON\nCheck browser console for detailed logs.';
        }

        function disableDebugMode() {
            if (!window.RSCMP) return;
            window.RSCMP.disableDebug();
            document.getElementById('debug-output').textContent = 'Debug mode is now OFF';
        }

        function testConsentMode() {
            if (!window.RSCMP) return;
            window.RSCMP.testConsentMode();
            document.getElementById('debug-output').textContent = 'Testing Google Consent Mode...\nCheck browser console for results.';
        }

        function getStatus() {
            if (!window.RSCMP) {
                document.getElementById('status-output').textContent = 'Error: RSCMP not loaded';
                return;
            }
            
            const status = window.RSCMP.getStatus();
            document.getElementById('status-output').textContent = 
`CMP Status:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Initialized: ${status.initialized}
Site ID: ${status.siteId || 'N/A (using inline config)'}
Banner Visible: ${status.bannerVisible}
Blocked Scripts: ${status.blockedScripts}

Current Consent:
  Necessary: ${status.consent?.necessary ?? 'N/A'}
  Analytics: ${status.consent?.analytics ?? 'N/A'}
  Marketing: ${status.consent?.marketing ?? 'N/A'}
  Preferences: ${status.consent?.preferences ?? 'N/A'}`;
        }

        function showPreferences() {
            if (!window.RSCMP) return;
            window.RSCMP.showPreferences();
            document.getElementById('methods-output').textContent = 'Showing preferences banner...';
        }

        function resetConsent() {
            if (!window.RSCMP) return;
            if (confirm('This will reset all consent choices. Continue?')) {
                window.RSCMP.resetConsent();
                document.getElementById('methods-output').textContent = 'Consent reset! Banner will show again.';
            }
        }

        function checkDataLayer() {
            if (!window.dataLayer) {
                document.getElementById('datalayer-output').textContent = 'DataLayer not found';
                return;
            }
            
            const consentEvents = window.dataLayer.filter(item => 
                item.event === 'cookie_consent_update'
            );
            
            if (consentEvents.length === 0) {
                document.getElementById('datalayer-output').textContent = 
'No consent events found in dataLayer yet.\nMake a consent choice to trigger a dataLayer push.';
            } else {
                const latest = consentEvents[consentEvents.length - 1];
                document.getElementById('datalayer-output').textContent = 
`DataLayer Events Found: ${consentEvents.length}

Latest Event:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Event: ${latest.event}
Analytics: ${latest.cookie_consent_analytics}
Marketing: ${latest.cookie_consent_marketing}
Preferences: ${latest.cookie_consent_preferences}
Necessary: ${latest.cookie_consent_necessary}
Timestamp: ${latest.consent_timestamp}`;
            }
        }

        // Simulate some tracking scripts for detection demo
        window.dataLayer = window.dataLayer || [];
        window.gtag = function() { dataLayer.push(arguments); };
    </script>
</body>
</html>
